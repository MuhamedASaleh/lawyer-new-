<!-- 
 <!DOCTYPE html>
 <html>
 <head>
     <title>Voice and Video Call with WebRTC and Socket.io</title>
 </head>
 <body>
     <h1>Voice and Video Call</h1>
     <button id="startVoiceCall">Start Voice Call</button>
     <button id="startVideoCall">Start Video Call</button>
     <button id="endCall" style="display:none;">End Call</button>
     <audio id="remoteAudio" autoplay></audio>
     <video id="localVideo" autoplay muted style="width: 300px; height: 300px; display:none;"></video>
     <video id="remoteVideo" autoplay style="width: 300px; height: 300px; display:none;"></video>
     <div id="callNotification" style="display:none;">
         <p>Incoming call from <span id="callerName"></span></p>
         <button id="acceptCall">Accept</button>
         <button id="rejectCall">Reject</button>
     </div>
     <div id="endCallNotification" style="display:none;">
         <p>The call has ended.</p>
     </div>
     <script src="/socket.io/socket.io.js"></script>
     <script>
         const socket = io();
 
         const startVoiceCallButton = document.getElementById('startVoiceCall');
         const startVideoCallButton = document.getElementById('startVideoCall');
         const endCallButton = document.getElementById('endCall');
         const remoteAudio = document.getElementById('remoteAudio');
         const localVideo = document.getElementById('localVideo');
         const remoteVideo = document.getElementById('remoteVideo');
         const callNotification = document.getElementById('callNotification');
         const callerName = document.getElementById('callerName');
         const acceptCallButton = document.getElementById('acceptCall');
         const rejectCallButton = document.getElementById('rejectCall');
         const endCallNotification = document.getElementById('endCallNotification');
 
         let localStream;
         let peerConnection;
         let remoteUserId;
         let isVideoCall = false;
 
         const configuration = {
             iceServers: [
                 { urls: 'stun:stun.l.google.com:19302' }
             ]
         };
 
         async function startCall(video) {
             try {
                 localStream = await navigator.mediaDevices.getUserMedia({ video: video, audio: true });
                 if (video) {
                     localVideo.srcObject = localStream;
                     localVideo.style.display = 'block';
                 } else {
                     remoteAudio.srcObject = localStream;
                 }
 
                 peerConnection = new RTCPeerConnection(configuration);
 
                 localStream.getTracks().forEach(track => {
                     peerConnection.addTrack(track, localStream);
                 });
 
                 peerConnection.onicecandidate = event => {
                     if (event.candidate) {
                         socket.emit('candidate', {
                             candidate: event.candidate.toJSON(),
                             target: remoteUserId
                         });
                     }
                 };
 
                 peerConnection.ontrack = event => {
                     if (event.track.kind === 'video') {
                         remoteVideo.srcObject = event.streams[0];
                         remoteVideo.style.display = 'block';
                     } else {
                         remoteAudio.srcObject = event.streams[0];
                     }
                 };
 
                 const offer = await peerConnection.createOffer();
                 await peerConnection.setLocalDescription(offer);
 
                 socket.emit('offer', {
                     sdp: peerConnection.localDescription,
                     target: remoteUserId,
                     video: video
                 });
 
                 // Show end call button and hide start call buttons
                 startVoiceCallButton.style.display = 'none';
                 startVideoCallButton.style.display = 'none';
                 endCallButton.style.display = 'block';
                 isVideoCall = video;
             } catch (error) {
                 console.error('Error starting call:', error);
             }
         }
 
         startVoiceCallButton.onclick = () => startCall(false);
         startVideoCallButton.onclick = () => startCall(true);
         socket.on('incomingCall', async data => {
             // Set the remote user ID
             remoteUserId = data.caller;
             isVideoCall = data.video;
 
             // Show call notification
             callNotification.style.display = 'block';
             callerName.textContent = remoteUserId;
 
             // Handle call acceptance
             acceptCallButton.onclick = async () => {
                 callNotification.style.display = 'none';
 
                 try {
                     peerConnection = new RTCPeerConnection(configuration);
 
                     peerConnection.onicecandidate = event => {
                         if (event.candidate) {
                             socket.emit('candidate', {
                                 candidate: event.candidate.toJSON(),
                                 target: remoteUserId
                             });
                         }
                     };
 
                     peerConnection.ontrack = event => {
                         if (event.track.kind === 'video') {
                             remoteVideo.srcObject = event.streams[0];
                             remoteVideo.style.display = 'block';
                         } else {
                             remoteAudio.srcObject = event.streams[0];
                         }
                     };
 
                     localStream = await navigator.mediaDevices.getUserMedia({ video: isVideoCall, audio: true });
                     if (isVideoCall) {
                         localVideo.srcObject = localStream;
                         localVideo.style.display = 'block';
                     } else {
                         remoteAudio.srcObject = localStream;
                     }
 
                     localStream.getTracks().forEach(track => {
                         peerConnection.addTrack(track, localStream);
                     });
 
                     await peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
 
                     const answer = await peerConnection.createAnswer();
                     await peerConnection.setLocalDescription(answer);
 
                     socket.emit('answer', {
                         sdp: peerConnection.localDescription,
                         target: remoteUserId
                     });
 
                     // Show end call button and hide start call buttons
                     startVoiceCallButton.style.display = 'none';
                     startVideoCallButton.style.display = 'none';
                     endCallButton.style.display = 'block';
                 } catch (error) {
                     console.error('Error accepting call:', error);
                 }
             };
 
             // Handle call rejection
             rejectCallButton.onclick = () => {
                 callNotification.style.display = 'none';
             };
         });
 
         socket.on('answer', async data => {
             try {
                 await peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
             } catch (error) {
                 console.error('Error handling answer:', error);
             }
         });
 
         socket.on('candidate', async data => {
             try {
                 const candidate = new RTCIceCandidate(data.candidate);
                 await peerConnection.addIceCandidate(candidate);
             } catch (error) {
                 console.error('Error adding received ICE candidate:', error);
             }
         });
 
         endCallButton.onclick = () => {
             if (peerConnection) {
                 peerConnection.close();
                 peerConnection = null;
                 socket.emit('endCall', { target: remoteUserId });
                 startVoiceCallButton.style.display = 'block';
                 startVideoCallButton.style.display = 'block';
                 endCallButton.style.display = 'none';
                 localVideo.style.display = 'none';
                 remoteVideo.style.display = 'none';
             }
         };
 
         // Listen for call end notifications
         socket.on('endCallNotification', () => {
             endCallNotification.style.display = 'block';
             setTimeout(() => {
                 endCallNotification.style.display = 'none';
             }, 3000); // Hide notification after 3 seconds
             startVoiceCallButton.style.display = 'block';
             startVideoCallButton.style.display = 'block';
             endCallButton.style.display = 'none';
             localVideo.style.display = 'none';
             remoteVideo.style.display = 'none';
         });
 
         // Emit a signal to notify when a new user connects
         socket.emit('new-user', { userId: socket.id });
 
         // Listen for new users to set remote user ID
         socket.on('new-user', data => {
             if (!remoteUserId) {
                 remoteUserId = data.userId;
             }
         });
     </script>
 </body>
 </html>
   -->
 


   <!-- <!DOCTYPE html>
<html>
<head>
    <title>Socket.io User Presence</title>
    <style>
        #userList {
            list-style-type: none;
            padding: 0;
        }
        #userList li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Online Users</h1>
    <ul id="userList"></ul>
    <button id="simulateConnection">Simulate User Connection</button>
    <button id="simulateDisconnection">Simulate User Disconnection</button>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const userList = document.getElementById('userList');
        
        // Update the list of online users
        function updateUserList(users) {
            userList.innerHTML = '';
            Object.values(users).forEach(user => {
                const li = document.createElement('li');
                li.textContent = `User ID: ${user.userId}`;
                userList.appendChild(li);
            });
        }

        // Handle new user connections
        socket.on('update-online-users', (data) => {
            console.log('Online users updated:', data.onlineUsers);
            updateUserList(data.onlineUsers);
        });

        // Handle user disconnection
        socket.on('user-disconnected', (data) => {
            console.log('User disconnected:', data.userId);
            // Optionally update the UI to reflect the disconnection
        });

        // Simulate new user connection
        document.getElementById('simulateConnection').onclick = () => {
            // Replace with actual user ID or simulate with a random one
            socket.emit('new-user', { userId: 'user_' + Math.random().toString(36).substr(2, 9) });
        };

        // Simulate user disconnection
        document.getElementById('simulateDisconnection').onclick = () => {
            // Emit a disconnect event manually for testing purposes
            socket.disconnect();
        };
    </script>
</body>
</html>
 -->



 <!DOCTYPE html>
 <html>
 <head>
     <title>Socket.io Video Call Simulation</title>
     <style>
         #userList {
             list-style-type: none;
             padding: 0;
         }
         #userList li {
             margin: 5px 0;
             display: flex;
             align-items: center;
         }
         #userList .video-icon {
             cursor: pointer;
             margin-left: 10px;
         }
     </style>
 </head>
 <body>
     <h1>Socket.io Video Call Simulation</h1>
     <ul id="userList"></ul>
 
     <h2>Start a Video Call</h2>
     <label for="callerId">Caller ID:</label>
     <input type="text" id="callerId" placeholder="Enter caller ID">
     <br>
     <label for="calleeId">Callee ID:</label>
     <input type="text" id="calleeId" placeholder="Enter callee ID">
     <br>
     <button id="startCall">Start Video Call</button>
 
     <button id="simulateConnection">Simulate User Connection</button>
     <button id="simulateDisconnection">Simulate User Disconnection</button>
     
     <script src="/socket.io/socket.io.js"></script>
     <script>
         const socket = io();
         const userList = document.getElementById('userList');
         const startCallButton = document.getElementById('startCall');
         const callerIdInput = document.getElementById('callerId');
         const calleeIdInput = document.getElementById('calleeId');
         let currentUserId = null;
 
         // Update the list of online users
         function updateUserList(users) {
             userList.innerHTML = '';
             Object.keys(users).forEach(socketId => {
                 const user = users[socketId];
                 const li = document.createElement('li');
                 li.textContent = `User ID: ${user.userId}, Socket ID: ${socketId}`;
                 
                 // Create a video call icon
                 const videoIcon = document.createElement('img');
                 videoIcon.src = 'video-call-icon.png'; // Replace with your video call icon path
                 videoIcon.className = 'video-icon';
                 videoIcon.onclick = () => startVideoCall(user.userId);
                 
                 li.appendChild(videoIcon);
                 userList.appendChild(li);
             });
         }
 
         // Start a video call
         function startVideoCall(calleeId) {
             if (currentUserId) {
                 socket.emit('joinRoom', { callerId: currentUserId, calleeId });
             }
         }
 
         // Handle new user connections
         socket.on('update-online-users', (data) => {
             console.log('Online users updated:', data.onlineUsers);
             updateUserList(data.onlineUsers);
         });
 
         // Handle user disconnection
         socket.on('user-disconnected', (data) => {
             console.log('User disconnected:', data.userId);
             // Optionally update the UI to reflect the disconnection
         });
 
         // Handle room joining and end call notifications
         socket.on('join-room', (data) => {
             console.log('Joined room:', data);
         });
 
         socket.on('end-call-notification', () => {
             console.log('Call ended');
         });
 
         // Start video call when button is clicked
         startCallButton.onclick = () => {
             const callerId = callerIdInput.value.trim();
             const calleeId = calleeIdInput.value.trim();
             if (callerId && calleeId) {
                 socket.emit('joinRoom', { callerId, calleeId });
             } else {
                 alert('Please enter both Caller ID and Callee ID');
             }
         };
 
         // Simulate new user connection
         document.getElementById('simulateConnection').onclick = () => {
             if (currentUserId === null) {
                 currentUserId = 'user_' + Math.random().toString(36).substr(2, 9);
                 socket.emit('new-user', { userId: currentUserId });
             }
         };
 
         // Simulate user disconnection
         document.getElementById('simulateDisconnection').onclick = () => {
             socket.disconnect();
             currentUserId = null;
         };
     </script>
 </body>
 </html>
 
 
